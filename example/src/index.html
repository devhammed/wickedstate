<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Wicked State Example</title>
</head>
<body>
<h1
    data-state="{
        name: null,
        init() {
            this.$effect(() => {
                if ( ! this.name) {
                    return;
                }

                console.log('name changed to', this.name);
            });

            return fetch('https://jsonplaceholder.typicode.com/users/1')
                .then((response) => response.json())
                .then((json) => {
                    this.name = json.name;

                    setTimeout(() => {
                        this.name = 'John Doe';

                        setTimeout(() => {
                            this.name = 'Jane Doe';
                        }, 2000);
                    }, 2000);
                })
                .catch((error) => {
                    alert('Error:', error);
                });
        },
        placeholder() {
            return 'Loading...';
        },
    }"
    data-bind="{
        text: `Welcome, ${name ?? 'Guest'}!`,
    }"
>
</h1>
<div
    data-state="{
        count: 0,
        init() {
            this.$watch(() => this.count, function (count, oldCount) {
                console.log('count changed from', oldCount, 'to', count);

                if (count > 5) {
                    this.$refs.fiveTimes.style.color = 'red';
                } else {
                    this.$refs.fiveTimes.style.color = 'black';
                }
            });
        }
    }"
>
    <p data-bind="{ text: count }"></p>
    <p data-bind="{ show: count >= 5 }">
        You have clicked the button more than 5 times!
    </p>
    <template data-bind="{ when: count >= 10 }">
        <div
            data-state="{ init() { console.log('in the DOM!') } }"
            data-bind="{ text: 'You are definitely a clicker with ' + $parent.count + ' clicks!' }"
        ></div>
    </template>
    <p data-bind="{
        ref: 'fiveTimes',
        text: count > 0 ? 'This will be red if you go over 5!' : 'Click the button to start counting!',
    }"></p>
    <button
        data-bind="{
            on: {
                click() {
                    count++;
                },
            },
        }"
    >
        Increment
    </button>
    <button
        data-bind="{
            on: {
                click() {
                    count--;
                },
            },
        }"
    >
        Decrement
    </button>
    <button
        data-state="{ count: 0 }"
        data-bind="{
        text: `Single Element Count: ${count}, Parent Count: ${$parent.count}`,
        on: {
            click() {
                count++;
            },
        },
    }"
    ></button>
</div>

<script type="module" src="./index.ts"></script>
</body>
</html>
